---
title: "Vue3ã®Provide / Injectã‚’å®Œå…¨ç†è§£ï¼ä¾å­˜æ€§æ³¨å…¥ã®åŸºæœ¬ã‹ã‚‰å®Ÿè·µã¾ã§"
emoji: "ğŸ’‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vue", "javascript", "frontend"]
published: false
---

# Vue3ã®Provide / Injectã‚’å®Œå…¨ç†è§£ï¼ä¾å­˜æ€§æ³¨å…¥ã®åŸºæœ¬ã‹ã‚‰å®Ÿè·µã¾ã§

Vue3ã®Provide / Injectã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§ãƒ‡ãƒ¼ã‚¿ã‚„æ©Ÿèƒ½ã‚’åŠ¹ç‡çš„ã«å…±æœ‰ã™ã‚‹ãŸã‚ã®å¼·åŠ›ãªæ©Ÿèƒ½ã§ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ã€Provide / Injectã®åŸºæœ¬æ¦‚å¿µã‹ã‚‰å®Ÿè·µçš„ãªå¿œç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã¾ã§ã€æ®µéšçš„ã«è©³ã—ãè§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

## Provide / Injectã¨ã¯

Provide / Injectã¯ã€Vue3ã®ä¾å­˜æ€§æ³¨å…¥ï¼ˆDependency Injectionï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã§ã™ã€‚è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§`provide`ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚„æ©Ÿèƒ½ã‚’æä¾›ã—ã€å­å­«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§`inject`ã‚’ä½¿ã£ã¦ãã‚Œã‚‰ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### åŸºæœ¬çš„ãªProvide / Injectã®ä¾‹

```vue
<!-- ParentComponent.vue -->
<template>
  <div>
    <ChildComponent />
  </div>
</template>

<script setup>
import { provide } from 'vue'
import ChildComponent from './ChildComponent.vue'

// ãƒ‡ãƒ¼ã‚¿ã‚’æä¾›
provide('message', 'Hello from parent!')
provide('count', 0)
</script>
```

```vue
<!-- ChildComponent.vue -->
<template>
  <div>
    <p>{{ message }}</p>
    <p>Count: {{ count }}</p>
  </div>
</template>

<script setup>
import { inject } from 'vue'

// ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Š
const message = inject('message')
const count = inject('count')
</script>
```

## åŸºæœ¬çš„ãªä½¿ã„æ–¹

### 1. æ–‡å­—åˆ—ã‚„æ•°å€¤ã®æä¾›

```vue
<!-- ParentComponent.vue -->
<script setup>
import { provide } from 'vue'

provide('appName', 'My Vue App')
provide('version', '1.0.0')
provide('isProduction', true)
</script>
```

```vue
<!-- ChildComponent.vue -->
<script setup>
import { inject } from 'vue'

const appName = inject('appName')
const version = inject('version')
const isProduction = inject('isProduction')

console.log(`${appName} v${version}`) // "My Vue App v1.0.0"
</script>
```

### 2. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æä¾›

```vue
<!-- ParentComponent.vue -->
<script setup>
import { provide, reactive } from 'vue'

const user = reactive({
  name: 'ç”°ä¸­å¤ªéƒ',
  email: 'tanaka@example.com',
  role: 'admin'
})

provide('user', user)
</script>
```

```vue
<!-- ChildComponent.vue -->
<script setup>
import { inject } from 'vue'

const user = inject('user')
console.log(user.name) // "ç”°ä¸­å¤ªéƒ"
</script>
```

## ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®è¨­å®š

`inject`ã®ç¬¬äºŒå¼•æ•°ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã§ãã¾ã™ã€‚

```vue
<!-- ChildComponent.vue -->
<script setup>
import { inject } from 'vue'

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
const theme = inject('theme', 'light')
const language = inject('language', 'ja')
const apiUrl = inject('apiUrl', 'https://api.example.com')
</script>
```

## é–¢æ•°ã®æä¾›

é–¢æ•°ã‚‚Provide / Injectã§å…±æœ‰ã§ãã¾ã™ã€‚

```vue
<!-- ParentComponent.vue -->
<script setup>
import { provide } from 'vue'

const showNotification = (message) => {
  alert(message)
}

const logError = (error) => {
  console.error('Error:', error)
}

provide('showNotification', showNotification)
provide('logError', logError)
</script>
```

```vue
<!-- ChildComponent.vue -->
<script setup>
import { inject } from 'vue'

const showNotification = inject('showNotification')
const logError = inject('logError')

// é–¢æ•°ã‚’ä½¿ç”¨
const handleClick = () => {
  showNotification('ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸï¼')
}
</script>
```

## ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‡ãƒ¼ã‚¿ã®æä¾›

### refã‚’ä½¿ã£ãŸãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‡ãƒ¼ã‚¿

```vue
<!-- ParentComponent.vue -->
<script setup>
import { provide, ref } from 'vue'

const count = ref(0)
const increment = () => count.value++

provide('count', count)
provide('increment', increment)
</script>
```

```vue
<!-- ChildComponent.vue -->
<template>
  <div>
    <p>Count: {{ count }}</p>
    <button @click="increment">Increment</button>
  </div>
</template>

<script setup>
import { inject } from 'vue'

const count = inject('count')
const increment = inject('increment')
</script>
```

### reactiveã‚’ä½¿ã£ãŸãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

```vue
<!-- ParentComponent.vue -->
<script setup>
import { provide, reactive } from 'vue'

const state = reactive({
  todos: [],
  addTodo: (text) => {
    state.todos.push({ id: Date.now(), text, completed: false })
  },
  toggleTodo: (id) => {
    const todo = state.todos.find(t => t.id === id)
    if (todo) todo.completed = !todo.completed
  }
})

provide('todoState', state)
</script>
```

```vue
<!-- ChildComponent.vue -->
<template>
  <div>
    <ul>
      <li v-for="todo in todoState.todos" :key="todo.id">
        <input 
          type="checkbox" 
          :checked="todo.completed"
          @change="todoState.toggleTodo(todo.id)"
        >
        {{ todo.text }}
      </li>
    </ul>
    <button @click="addTodo">Add Todo</button>
  </div>
</template>

<script setup>
import { inject } from 'vue'

const todoState = inject('todoState')
const addTodo = () => todoState.addTodo('New Todo')
</script>
```

## å®Ÿè·µçš„ãªå¿œç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

### 1. ãƒ†ãƒ¼ãƒç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

```vue
<!-- ThemeProvider.vue -->
<template>
  <div :class="theme">
    <slot />
  </div>
</template>

<script setup>
import { provide, ref, computed } from 'vue'

const currentTheme = ref('light')

const theme = computed(() => ({
  light: 'theme-light',
  dark: 'theme-dark'
}[currentTheme.value]))

const toggleTheme = () => {
  currentTheme.value = currentTheme.value === 'light' ? 'dark' : 'light'
}

provide('theme', {
  currentTheme,
  theme,
  toggleTheme
})
</script>
```

```vue
<!-- ThemedButton.vue -->
<template>
  <button :class="themeClass" @click="handleClick">
    <slot />
  </button>
</template>

<script setup>
import { inject, computed } from 'vue'

const theme = inject('theme')
const themeClass = computed(() => `btn-${theme.currentTheme.value}`)

const handleClick = () => {
  theme.toggleTheme()
}
</script>
```

### 2. APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å…±æœ‰

```vue
<!-- ApiProvider.vue -->
<script setup>
import { provide } from 'vue'

class ApiClient {
  constructor(baseURL) {
    this.baseURL = baseURL
  }

  async get(endpoint) {
    const response = await fetch(`${this.baseURL}${endpoint}`)
    return response.json()
  }

  async post(endpoint, data) {
    const response = await fetch(`${this.baseURL}${endpoint}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
    return response.json()
  }
}

const apiClient = new ApiClient('https://api.example.com')
provide('apiClient', apiClient)
</script>
```

```vue
<!-- UserList.vue -->
<template>
  <div>
    <ul>
      <li v-for="user in users" :key="user.id">
        {{ user.name }}
      </li>
    </ul>
  </div>
</template>

<script setup>
import { inject, ref, onMounted } from 'vue'

const apiClient = inject('apiClient')
const users = ref([])

onMounted(async () => {
  users.value = await apiClient.get('/users')
})
</script>
```

### 3. ãƒ¢ãƒ¼ãƒ€ãƒ«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

```vue
<!-- ModalProvider.vue -->
<template>
  <div>
    <slot />
    <div v-if="isOpen" class="modal-overlay" @click="close">
      <div class="modal-content" @click.stop>
        <component :is="modalComponent" v-bind="modalProps" />
      </div>
    </div>
  </div>
</template>

<script setup>
import { provide, ref } from 'vue'

const isOpen = ref(false)
const modalComponent = ref(null)
const modalProps = ref({})

const openModal = (component, props = {}) => {
  modalComponent.value = component
  modalProps.value = props
  isOpen.value = true
}

const closeModal = () => {
  isOpen.value = false
  modalComponent.value = null
  modalProps.value = {}
}

provide('modal', {
  openModal,
  closeModal
})
</script>
```

```vue
<!-- UserProfile.vue -->
<template>
  <div>
    <h2>{{ user.name }}</h2>
    <button @click="openEditModal">ç·¨é›†</button>
  </div>
</template>

<script setup>
import { inject } from 'vue'
import EditUserModal from './EditUserModal.vue'

const modal = inject('modal')
const user = { name: 'ç”°ä¸­å¤ªéƒ', email: 'tanaka@example.com' }

const openEditModal = () => {
  modal.openModal(EditUserModal, { user })
}
</script>
```

## å‹å®‰å…¨æ€§ã®å‘ä¸Š

TypeScriptã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€å‹å®‰å…¨æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```typescript
// types.ts
export interface User {
  id: number
  name: string
  email: string
}

export interface ApiClient {
  get<T>(endpoint: string): Promise<T>
  post<T>(endpoint: string, data: any): Promise<T>
}
```

```vue
<!-- ParentComponent.vue -->
<script setup lang="ts">
import { provide } from 'vue'
import type { User, ApiClient } from './types'

const user: User = {
  id: 1,
  name: 'ç”°ä¸­å¤ªéƒ',
  email: 'tanaka@example.com'
}

const apiClient: ApiClient = {
  async get<T>(endpoint: string): Promise<T> {
    // å®Ÿè£…
  },
  async post<T>(endpoint: string, data: any): Promise<T> {
    // å®Ÿè£…
  }
}

provide<User>('user', user)
provide<ApiClient>('apiClient', apiClient)
</script>
```

```vue
<!-- ChildComponent.vue -->
<script setup lang="ts">
import { inject } from 'vue'
import type { User, ApiClient } from './types'

const user = inject<User>('user')
const apiClient = inject<ApiClient>('apiClient')

// å‹å®‰å…¨ã«ä½¿ç”¨å¯èƒ½
if (user) {
  console.log(user.name) // å‹ãƒã‚§ãƒƒã‚¯æ¸ˆã¿
}
</script>
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ã‚­ãƒ¼ã®å‘½åè¦å‰‡

```javascript
// è‰¯ã„ä¾‹ï¼šæ˜ç¢ºã§ä¸€æ„ãªã‚­ãƒ¼å
provide('userService', userService)
provide('themeConfig', themeConfig)
provide('apiClient', apiClient)

// æ‚ªã„ä¾‹ï¼šæ›–æ˜§ã§é‡è¤‡ã—ã‚„ã™ã„ã‚­ãƒ¼å
provide('data', data)
provide('config', config)
provide('service', service)
```

### 2. ã‚·ãƒ³ãƒœãƒ«ã‚­ãƒ¼ã®ä½¿ç”¨

```javascript
// ã‚·ãƒ³ãƒœãƒ«ã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦åå‰ã®è¡çªã‚’é˜²ã
const USER_SERVICE_KEY = Symbol('userService')
const THEME_CONFIG_KEY = Symbol('themeConfig')

provide(USER_SERVICE_KEY, userService)
provide(THEME_CONFIG_KEY, themeConfig)
```

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```vue
<script setup>
import { inject } from 'vue'

const userService = inject('userService')

if (!userService) {
  throw new Error('userService is not provided')
}

// å®‰å…¨ã«ä½¿ç”¨
userService.getUser()
</script>
```

## æ³¨æ„ç‚¹ã¨åˆ¶é™

### 1. ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ä¸Šæ›¸ã

```vue
<!-- æ³¨æ„ï¼šå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§provideã—ãŸå€¤ã¯è¦ªã®å€¤ã‚’ä¸Šæ›¸ãã™ã‚‹ -->
<script setup>
// è¦ªã§æä¾›ã•ã‚ŒãŸå€¤ã‚’ä¸Šæ›¸ã
provide('message', 'Child message')
</script>
```

### 2. ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®ä¿æŒ

```vue
<script setup>
import { provide, ref, toRefs } from 'vue'

const state = reactive({ count: 0 })

// ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’ä¿æŒã™ã‚‹ãŸã‚ã«toRefsã‚’ä½¿ç”¨
provide('state', toRefs(state))
</script>
```

## ã¾ã¨ã‚

Vue3ã®Provide / Injectã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰ã‚’åŠ¹ç‡çš„ã«è¡Œã†ãŸã‚ã®å¼·åŠ›ãªæ©Ÿèƒ½ã§ã™ã€‚ä¸»ãªãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

- **ä¾å­˜æ€§æ³¨å…¥ãƒ‘ã‚¿ãƒ¼ãƒ³**ï¼šè¦ªã‹ã‚‰å­å­«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®ãƒ‡ãƒ¼ã‚¿æä¾›
- **ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‡ãƒ¼ã‚¿**ï¼šrefã‚„reactiveã¨çµ„ã¿åˆã‚ã›ã¦ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªçŠ¶æ…‹ç®¡ç†
- **å‹å®‰å…¨æ€§**ï¼šTypeScriptã¨çµ„ã¿åˆã‚ã›ã¦å‹å®‰å…¨ãªé–‹ç™º
- **å®Ÿè·µçš„ãªå¿œç”¨**ï¼šãƒ†ãƒ¼ãƒç®¡ç†ã€APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ãƒ¢ãƒ¼ãƒ€ãƒ«ç®¡ç†ãªã©

é©åˆ‡ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†åˆ©ç”¨æ€§ã¨ä¿å®ˆæ€§ã‚’å¤§å¹…ã«å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ãƒ‰ãƒªãƒªãƒ³ã‚°ï¼ˆprops drillingï¼‰ã‚’é¿ã‘ã€ã‚¯ãƒªãƒ¼ãƒ³ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã«ã€Provide / Injectã‚’ç©æ¥µçš„ã«æ´»ç”¨ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚
