---
title: "Vue 3ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†"
emoji: "ğŸ¯"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vue", "javascript", "frontend"]
published: false
---

# Vue 3ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†

Vue 3ã®**ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–**ã«ã¤ã„ã¦ã€å®Ÿç”¨çš„ãªä¾‹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’äº¤ãˆãªãŒã‚‰è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€DOMæ“ä½œã‚’åŠ¹ç‡çš„ã«è¡Œã„ã€å†åˆ©ç”¨å¯èƒ½ãªæ©Ÿèƒ½ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚

## ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¨ã¯ï¼Ÿ

ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¯ã€Vueã®çµ„ã¿è¾¼ã¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆ`v-model`ã€`v-if`ãªã©ï¼‰ã‚’æ‹¡å¼µã—ã€**DOMè¦ç´ ã«å¯¾ã—ã¦ç›´æ¥çš„ãªæ“ä½œ**ã‚’è¡Œã†ãŸã‚ã®æ©Ÿèƒ½ã§ã™ã€‚ä¸»ã«ä»¥ä¸‹ã®ç”¨é€”ã§ä½¿ç”¨ã•ã‚Œã¾ã™ï¼š

- DOMè¦ç´ ã®ç›´æ¥æ“ä½œ
- ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã®çµ±åˆ
- å†åˆ©ç”¨å¯èƒ½ãªDOMæ“ä½œãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

Vue 3ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã«ã¯ä»¥ä¸‹ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯ãŒã‚ã‚Šã¾ã™ï¼š

```javascript
const myDirective = {
  // è¦ç´ ãŒDOMã«æŒ¿å…¥ã•ã‚Œã‚‹å‰ã«å‘¼ã°ã‚Œã‚‹
  created(el, binding, vnode, prevVnode) {},
  
  // è¦ç´ ãŒDOMã«æŒ¿å…¥ã•ã‚ŒãŸå¾Œã«å‘¼ã°ã‚Œã‚‹
  mounted(el, binding, vnode, prevVnode) {},
  
  // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®VNodeãŒæ›´æ–°ã•ã‚Œã‚‹å‰ã«å‘¼ã°ã‚Œã‚‹
  beforeUpdate(el, binding, vnode, prevVnode) {},
  
  // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨å­è¦ç´ ã®VNodeãŒæ›´æ–°ã•ã‚ŒãŸå¾Œã«å‘¼ã°ã‚Œã‚‹
  updated(el, binding, vnode, prevVnode) {},
  
  // è¦ç´ ãŒDOMã‹ã‚‰å‰Šé™¤ã•ã‚Œã‚‹å‰ã«å‘¼ã°ã‚Œã‚‹
  beforeUnmount(el, binding, vnode, prevVnode) {},
  
  // è¦ç´ ãŒDOMã‹ã‚‰å‰Šé™¤ã•ã‚ŒãŸå¾Œã«å‘¼ã°ã‚Œã‚‹
  unmounted(el, binding, vnode, prevVnode) {}
}
```

## åŸºæœ¬çš„ãªã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®ä¾‹

### 1. ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–

```javascript
// main.js
import { createApp } from 'vue'
import App from './App.vue'

const app = createApp(App)

// ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–
app.directive('focus', {
  mounted(el) {
    el.focus()
  }
})

app.mount('#app')
```

```vue
<!-- App.vue -->
<template>
  <div>
    <input v-focus placeholder="è‡ªå‹•ã§ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã•ã‚Œã¾ã™" />
  </div>
</template>
```

### 2. è‰²å¤‰æ›´ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–

```javascript
// main.js
app.directive('color', {
  mounted(el, binding) {
    el.style.color = binding.value
  },
  updated(el, binding) {
    el.style.color = binding.value
  }
})
```

```vue
<template>
  <div>
    <p v-color="'red'">èµ¤ã„ãƒ†ã‚­ã‚¹ãƒˆ</p>
    <p v-color="dynamicColor">å‹•çš„ãªè‰²</p>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const dynamicColor = ref('blue')
</script>
```

## å®Ÿç”¨çš„ãªã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®ä¾‹

### 1. ã‚¯ãƒªãƒƒã‚¯ã‚¢ã‚¦ã‚µã‚¤ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–

```javascript
// directives/clickOutside.js
export const clickOutside = {
  mounted(el, binding) {
    el.clickOutsideEvent = function(event) {
      if (!(el === event.target || el.contains(event.target))) {
        binding.value(event)
      }
    }
    document.addEventListener('click', el.clickOutsideEvent)
  },
  unmounted(el) {
    document.removeEventListener('click', el.clickOutsideEvent)
  }
}
```

```vue
<template>
  <div>
    <div v-click-outside="closeModal" class="modal">
      <p>ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</p>
      <button @click="closeModal">é–‰ã˜ã‚‹</button>
    </div>
  </div>
</template>

<script setup>
const closeModal = () => {
  console.log('ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¾ã™')
}
</script>
```

### 2. ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–

```javascript
// directives/infiniteScroll.js
export const infiniteScroll = {
  mounted(el, binding) {
    const options = {
      root: null,
      rootMargin: '0px',
      threshold: 1.0
    }
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          binding.value()
        }
      })
    }, options)
    
    observer.observe(el)
    el._observer = observer
  },
  unmounted(el) {
    if (el._observer) {
      el._observer.disconnect()
    }
  }
}
```

```vue
<template>
  <div>
    <div v-for="item in items" :key="item.id" class="item">
      {{ item.content }}
    </div>
    <div v-infinite-scroll="loadMore" class="loading-trigger">
      èª­ã¿è¾¼ã¿ä¸­...
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'

const items = ref([])
let page = 1

const loadMore = async () => {
  // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
  const newItems = await fetchItems(page++)
  items.value.push(...newItems)
}

const fetchItems = async (page) => {
  // APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  return [{ id: page, content: `ã‚¢ã‚¤ãƒ†ãƒ  ${page}` }]
}

onMounted(() => {
  loadMore()
})
</script>
```

### 3. ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–

```javascript
// directives/draggable.js
export const draggable = {
  mounted(el, binding) {
    let isDragging = false
    let startX = 0
    let startY = 0
    let initialX = 0
    let initialY = 0
    
    el.style.position = 'absolute'
    el.style.cursor = 'move'
    
    const handleMouseDown = (e) => {
      isDragging = true
      startX = e.clientX
      startY = e.clientY
      initialX = el.offsetLeft
      initialY = el.offsetTop
      
      document.addEventListener('mousemove', handleMouseMove)
      document.addEventListener('mouseup', handleMouseUp)
    }
    
    const handleMouseMove = (e) => {
      if (!isDragging) return
      
      const deltaX = e.clientX - startX
      const deltaY = e.clientY - startY
      
      el.style.left = initialX + deltaX + 'px'
      el.style.top = initialY + deltaY + 'px'
    }
    
    const handleMouseUp = () => {
      isDragging = false
      document.removeEventListener('mousemove', handleMouseMove)
      document.removeEventListener('mouseup', handleMouseUp)
      
      if (binding.value && typeof binding.value === 'function') {
        binding.value({
          x: el.offsetLeft,
          y: el.offsetTop
        })
      }
    }
    
    el.addEventListener('mousedown', handleMouseDown)
    el._cleanup = () => {
      el.removeEventListener('mousedown', handleMouseDown)
    }
  },
  unmounted(el) {
    if (el._cleanup) {
      el._cleanup()
    }
  }
}
```

```vue
<template>
  <div class="container">
    <div 
      v-draggable="onDragEnd" 
      class="draggable-box"
    >
      ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãã ã•ã„
    </div>
  </div>
</template>

<script setup>
const onDragEnd = (position) => {
  console.log('æ–°ã—ã„ä½ç½®:', position)
}
</script>

<style>
.container {
  position: relative;
  height: 400px;
  border: 1px solid #ccc;
}

.draggable-box {
  width: 100px;
  height: 100px;
  background-color: #007bff;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
}
</style>
```

### 4. é…å»¶èª­ã¿è¾¼ã¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–

```javascript
// directives/lazyLoad.js
export const lazyLoad = {
  mounted(el, binding) {
    const options = {
      root: null,
      rootMargin: '50px',
      threshold: 0.1
    }
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target
          img.src = binding.value
          img.classList.remove('lazy')
          observer.unobserve(img)
        }
      })
    }, options)
    
    observer.observe(el)
    el._observer = observer
  },
  unmounted(el) {
    if (el._observer) {
      el._observer.disconnect()
    }
  }
}
```

```vue
<template>
  <div>
    <img 
      v-lazy-load="imageUrl" 
      class="lazy"
      alt="é…å»¶èª­ã¿è¾¼ã¿ç”»åƒ"
    />
  </div>
</template>

<script setup>
const imageUrl = 'https://example.com/image.jpg'
</script>

<style>
.lazy {
  opacity: 0;
  transition: opacity 0.3s;
}

.lazy:not(.lazy) {
  opacity: 1;
}
</style>
```

### 5. æ¨©é™ãƒã‚§ãƒƒã‚¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–

```javascript
// directives/permission.js
export const permission = {
  mounted(el, binding) {
    const { value } = binding
    const userPermissions = getUserPermissions() // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã‚’å–å¾—
    
    if (!hasPermission(userPermissions, value)) {
      el.style.display = 'none'
      // ã¾ãŸã¯è¦ç´ ã‚’å‰Šé™¤
      // el.remove()
    }
  },
  updated(el, binding) {
    const { value } = binding
    const userPermissions = getUserPermissions()
    
    if (hasPermission(userPermissions, value)) {
      el.style.display = ''
    } else {
      el.style.display = 'none'
    }
  }
}

function getUserPermissions() {
  // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ã‚¹ãƒˆã‚¢ã‚„APIã‹ã‚‰å–å¾—
  return ['read', 'write'] // ä¾‹
}

function hasPermission(userPermissions, requiredPermission) {
  return userPermissions.includes(requiredPermission)
}
```

```vue
<template>
  <div>
    <button v-permission="'admin'">ç®¡ç†è€…ã®ã¿è¡¨ç¤º</button>
    <button v-permission="'write'">ç·¨é›†æ¨©é™ãŒå¿…è¦</button>
    <button v-permission="'read'">èª­ã¿å–ã‚Šæ¨©é™ãŒå¿…è¦</button>
  </div>
</template>
```

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®å¼•æ•°ã¨ä¿®é£¾å­

### å¼•æ•°ã®ä½¿ç”¨

```javascript
// main.js
app.directive('pin', {
  mounted(el, binding) {
    el.style.position = 'fixed'
    el.style.top = binding.arg + 'px'
  }
})
```

```vue
<template>
  <div v-pin:top="200">ä¸Šã‹ã‚‰200pxã®ä½ç½®ã«å›ºå®š</div>
</template>
```

### ä¿®é£¾å­ã®ä½¿ç”¨

```javascript
// main.js
app.directive('on', {
  mounted(el, binding) {
    const { arg, modifiers, value } = binding
    const eventName = arg || 'click'
    
    // ä¿®é£¾å­ã«åŸºã¥ã„ã¦ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
    if (modifiers.once) {
      el.addEventListener(eventName, value, { once: true })
    } else if (modifiers.capture) {
      el.addEventListener(eventName, value, { capture: true })
    } else {
      el.addEventListener(eventName, value)
    }
  }
})
```

```vue
<template>
  <button v-on:click.once="handleClick">ä¸€åº¦ã ã‘ã‚¯ãƒªãƒƒã‚¯å¯èƒ½</button>
  <button v-on:click.capture="handleClick">ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¢ãƒ¼ãƒ‰</button>
</template>
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. é©åˆ‡ãªãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†

```javascript
// âœ… è‰¯ã„ä¾‹ï¼šé©åˆ‡ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
export const myDirective = {
  mounted(el, binding) {
    const handler = binding.value
    el._handler = handler
    document.addEventListener('click', handler)
  },
  unmounted(el) {
    if (el._handler) {
      document.removeEventListener('click', el._handler)
    }
  }
}
```

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è€ƒæ…®

```javascript
// âœ… è‰¯ã„ä¾‹ï¼šIntersectionObserverã‚’ä½¿ç”¨
export const lazyLoad = {
  mounted(el, binding) {
    const observer = new IntersectionObserver((entries) => {
      // å¿…è¦ãªæ™‚ã®ã¿å‡¦ç†
    })
    observer.observe(el)
    el._observer = observer
  },
  unmounted(el) {
    el._observer?.disconnect()
  }
}
```

### 3. å‹å®‰å…¨æ€§ï¼ˆTypeScriptä½¿ç”¨æ™‚ï¼‰

```typescript
// directives/types.ts
export interface DirectiveBinding<T = any> {
  value: T
  oldValue: T | null
  arg?: string
  modifiers: Record<string, boolean>
  instance: any
  dir: any
}

// directives/clickOutside.ts
export const clickOutside = {
  mounted(el: HTMLElement, binding: DirectiveBinding<(event: Event) => void>) {
    el.clickOutsideEvent = function(event: Event) {
      if (!(el === event.target || el.contains(event.target as Node))) {
        binding.value(event)
      }
    }
    document.addEventListener('click', el.clickOutsideEvent)
  },
  unmounted(el: HTMLElement) {
    document.removeEventListener('click', (el as any).clickOutsideEvent)
  }
}
```

### 4. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®ç™»éŒ²æ–¹æ³•

```javascript
// main.js - ã‚°ãƒ­ãƒ¼ãƒãƒ«ç™»éŒ²
import { createApp } from 'vue'
import App from './App.vue'
import { clickOutside, infiniteScroll } from './directives'

const app = createApp(App)

app.directive('click-outside', clickOutside)
app.directive('infinite-scroll', infiniteScroll)

app.mount('#app')
```

```vue
<!-- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ã®ãƒ­ãƒ¼ã‚«ãƒ«ç™»éŒ² -->
<script setup>
import { clickOutside } from './directives/clickOutside'

// ãƒ­ãƒ¼ã‚«ãƒ«ç™»éŒ²
const vClickOutside = clickOutside
</script>

<template>
  <div v-click-outside="handleClickOutside">
    ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  </div>
</template>
```

## ã¾ã¨ã‚

Vue 3ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¯ã€ä»¥ä¸‹ã®åˆ©ç‚¹ã‚’æä¾›ã—ã¾ã™ï¼š

- **DOMæ“ä½œã®åŠ¹ç‡åŒ–**: ç›´æ¥çš„ãªDOMæ“ä½œã‚’å¯èƒ½ã«ã™ã‚‹
- **å†åˆ©ç”¨æ€§**: è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§åŒã˜æ©Ÿèƒ½ã‚’å…±æœ‰
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: é©åˆ‡ãªãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ã§ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²æ­¢
- **æŸ”è»Ÿæ€§**: å¼•æ•°ã‚„ä¿®é£¾å­ã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½

ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚ŠåŠ¹ç‡çš„ã§ä¿å®ˆæ€§ã®é«˜ã„Vueã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚ãŸã ã—ã€éåº¦ãªä½¿ç”¨ã¯é¿ã‘ã€é©åˆ‡ãªå ´é¢ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

## å‚è€ƒãƒªãƒ³ã‚¯

- [Vue 3 ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://vuejs.org/guide/reusability/custom-directives.html)
- [VueUse](https://vueuse.org/) - å®Ÿç”¨çš„ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
